{
  "metadata": {
    "tester": "T3-User-Chaos",
    "persona": "P2 Chaos (Morgan)",
    "role": "USER",
    "generated_at": "2026-02-08T00:30:00Z",
    "method": "CODE_BASED",
    "total_scenarios": 11,
    "total_test_cases": 42,
    "total_issues_found": 8,
    "severity_breakdown": {
      "CRITICAL": 1,
      "HIGH": 3,
      "MEDIUM": 3,
      "LOW": 1
    }
  },

  "test_results": [
    {
      "scenario_id": "TC-007",
      "title": "Admin rejection without reason is prevented",
      "priority": "P0",
      "category": "member",
      "test_cases": [
        {
          "id": "T3-TC-007-01",
          "description": "Empty string rejection reason validation",
          "chaos_input": {"reason": ""},
          "expected_behavior": "Validation error: reason is required",
          "actual_behavior": "PASS - useRejectUser throws 'reason.trim().length === 0' check at useMemberHook.ts:1060",
          "result": "PASS",
          "evidence": {
            "file": "app/_lib/features/member-management/api/useMemberHook.ts",
            "line": 1060,
            "code": "if (!reason || reason.trim().length === 0) { throw new Error('반려 사유는 필수입니다.'); }"
          }
        },
        {
          "id": "T3-TC-007-02",
          "description": "Whitespace-only rejection reason validation",
          "chaos_input": {"reason": "   \t\n  "},
          "expected_behavior": "Validation error: reason cannot be whitespace only",
          "actual_behavior": "PASS - .trim().length === 0 catches whitespace-only strings",
          "result": "PASS",
          "evidence": {
            "file": "app/_lib/features/member-management/api/useMemberHook.ts",
            "line": 1060,
            "code": "reason.trim().length === 0"
          }
        },
        {
          "id": "T3-TC-007-03",
          "description": "Double-check state guard on non-PENDING_APPROVAL user",
          "chaos_input": {"user_status": "APPROVED"},
          "expected_behavior": "Rejection blocked: wrong state",
          "actual_behavior": "PASS - Pre-check at line 1075 and double-guard .eq('user_status', 'PENDING_APPROVAL') at line 1091",
          "result": "PASS",
          "evidence": {
            "file": "app/_lib/features/member-management/api/useMemberHook.ts",
            "lines": [1075, 1091]
          }
        }
      ],
      "overall_result": "PASS"
    },

    {
      "scenario_id": "TC-012",
      "title": "XSS prevention via DOMPurify sanitization",
      "priority": "P0",
      "category": "security",
      "test_cases": [
        {
          "id": "T3-TC-012-01",
          "description": "Script tag injection in content",
          "chaos_input": {"content": "<script>alert('XSS')</script>"},
          "expected_behavior": "Script tags stripped by DOMPurify",
          "actual_behavior": "PASS - sanitizeHtml() uses ALLOWED_TAGS whitelist, script not included. All 4 detail pages call sanitizeHtml() before dangerouslySetInnerHTML",
          "result": "PASS",
          "evidence": {
            "file": "app/_lib/shared/utils/sanitize.ts",
            "line": 11,
            "code": "ALLOWED_TAGS: ['p', 'br', 'strong', 'em', ... ]  // no 'script'",
            "consumers": [
              "app/[slug]/free-board/[id]/page.tsx:119",
              "app/[slug]/communication/free-board/[id]/page.tsx:115",
              "app/[slug]/news/notice/[id]/page.tsx:132",
              "app/[slug]/news/qna/[id]/page.tsx:190",
              "app/[slug]/communication/union-info/[id]/page.tsx:126"
            ]
          }
        },
        {
          "id": "T3-TC-012-02",
          "description": "Style attribute injection",
          "chaos_input": {"content": "<div style='background:url(javascript:alert(1))'>test</div>"},
          "expected_behavior": "Style attribute stripped",
          "actual_behavior": "PASS - FORBID_ATTR: ['style'] explicitly blocks style attributes",
          "result": "PASS",
          "evidence": {
            "file": "app/_lib/shared/utils/sanitize.ts",
            "line": 22,
            "code": "FORBID_ATTR: ['style']"
          }
        },
        {
          "id": "T3-TC-012-03",
          "description": "Event handler injection via img onerror",
          "chaos_input": {"content": "<img src=x onerror=alert('XSS')>"},
          "expected_behavior": "Event handlers stripped",
          "actual_behavior": "PASS - ALLOWED_ATTR whitelist does not include onerror/onload/etc. DOMPurify strips unwhitelisted attributes",
          "result": "PASS",
          "evidence": {
            "file": "app/_lib/shared/utils/sanitize.ts",
            "line": 18,
            "code": "ALLOWED_ATTR: ['href', 'src', 'alt', 'title', 'class', 'target', 'rel', 'width', 'height', 'colspan', 'rowspan']"
          }
        },
        {
          "id": "T3-TC-012-04",
          "description": "Data attribute injection",
          "chaos_input": {"content": "<div data-evil='payload'>test</div>"},
          "expected_behavior": "Data attributes stripped",
          "actual_behavior": "PASS - ALLOW_DATA_ATTR: false explicitly disables data-* attributes",
          "result": "PASS",
          "evidence": {
            "file": "app/_lib/shared/utils/sanitize.ts",
            "line": 23,
            "code": "ALLOW_DATA_ATTR: false"
          }
        },
        {
          "id": "T3-TC-012-05",
          "description": "XSS via sanitized content is client-only (DOMPurify not on server)",
          "chaos_input": {"content": "<script>alert(1)</script>"},
          "expected_behavior": "Server-side sanitization present",
          "actual_behavior": "ISSUE - DOMPurify is client-only (browser). If content is served via SSR before hydration, raw HTML may briefly render. sanitize.ts imports 'dompurify' (browser-only). No isomorphic-dompurify in package.json.",
          "result": "ISSUE",
          "severity": "MEDIUM",
          "issue_id": "CHAOS-001",
          "details": "Client-only DOMPurify means during SSR, sanitizeHtml() would fail or render unsanitized. However, all pages using sanitizeHtml are 'use client' components, so SSR only renders loading skeletons. Content is sanitized after hydration + data fetch. Risk is LOW in practice but architectural concern remains."
        }
      ],
      "overall_result": "PASS_WITH_NOTES",
      "notes": "XSS protection is effective for the current architecture (all detail pages are client components). The client-only DOMPurify is a known technical debt item."
    },

    {
      "scenario_id": "TC-035",
      "title": "Free board - Cannot delete other user's post",
      "priority": "P1",
      "category": "security",
      "test_cases": [
        {
          "id": "T3-TC-035-01",
          "description": "UI hides delete button for non-owner",
          "chaos_input": {"user_id": "user-002", "post_author_id": "user-001"},
          "expected_behavior": "Delete button not rendered",
          "actual_behavior": "PASS - isMine check: freeBoard?.author_id === user?.id at free-board/[id]/page.tsx:38, delete button wrapped in {isMine && ...}",
          "result": "PASS",
          "evidence": {
            "file": "app/[slug]/free-board/[id]/page.tsx",
            "line": 38,
            "code": "const isMine = freeBoard?.author_id === user?.id;"
          }
        },
        {
          "id": "T3-TC-035-02",
          "description": "Server-side ownership check on delete mutation",
          "chaos_input": {"attempt": "direct API call to delete other's post"},
          "expected_behavior": "Delete fails silently (no rows affected)",
          "actual_behavior": "PASS - useDeleteFreeBoard adds .eq('author_id', user.id) for non-admins at line 419",
          "result": "PASS",
          "evidence": {
            "file": "app/_lib/features/free-board/api/useFreeBoardHook.ts",
            "line": 419,
            "code": "if (!isAdmin && user?.id) { deleteQuery = deleteQuery.eq('author_id', user.id); }"
          }
        },
        {
          "id": "T3-TC-035-03",
          "description": "Delete cascade order vulnerability - files/comments deleted before ownership check",
          "chaos_input": {"attempt": "non-owner triggers delete of post with files and comments"},
          "expected_behavior": "No side effects if post delete fails",
          "actual_behavior": "ISSUE - Files and comments are deleted BEFORE the post ownership check. Steps 1-3 (storage files, DB file records, comments) execute unconditionally. Only step 4 has the author_id guard. If step 4 fails (non-owner), files and comments are already gone.",
          "result": "FAIL",
          "severity": "HIGH",
          "issue_id": "CHAOS-002",
          "details": "In useDeleteFreeBoard (lines 386-453): storage folder is deleted at line 392-393, DB file records deleted at line 396-401, comments deleted at line 407-415, all BEFORE the ownership-guarded delete at line 418-422. A non-owner user could theoretically trigger this mutation and lose all files/comments even though the post itself survives. The UI hides the button, but if the mutation is called directly (e.g., via DevTools), side effects are not rolled back. Same pattern exists in useDeleteQuestion (lines 373-423)."
        },
        {
          "id": "T3-TC-035-04",
          "description": "Same cascade issue in useDeleteQuestion",
          "chaos_input": {"attempt": "non-owner calls useDeleteQuestion directly"},
          "expected_behavior": "No side effects if question delete fails",
          "actual_behavior": "ISSUE - Storage folder deleted at line 379-380 before ownership-guarded delete at lines 383-392",
          "result": "FAIL",
          "severity": "HIGH",
          "issue_id": "CHAOS-003",
          "details": "useDeleteQuestion deletes storage files unconditionally before checking author_id ownership. Same structural issue as CHAOS-002."
        }
      ],
      "overall_result": "FAIL",
      "notes": "UI-level protection is solid, but mutation-level cascade order creates data loss risk if mutation is invoked directly."
    },

    {
      "scenario_id": "TC-037",
      "title": "Free board search with LIKE wildcard escape",
      "priority": "P1",
      "category": "content",
      "test_cases": [
        {
          "id": "T3-TC-037-01",
          "description": "Search for '%' character in free board",
          "chaos_input": {"searchQuery": "%"},
          "expected_behavior": "Escaped to '\\%', literal search",
          "actual_behavior": "PASS - escapeLikeWildcards applied at useFreeBoardHook.ts:52",
          "result": "PASS",
          "evidence": {
            "file": "app/_lib/features/free-board/api/useFreeBoardHook.ts",
            "line": 52,
            "code": "const escaped = escapeLikeWildcards(searchQuery.trim());"
          }
        },
        {
          "id": "T3-TC-037-02",
          "description": "Search for '_' character in free board",
          "chaos_input": {"searchQuery": "___"},
          "expected_behavior": "Escaped to '\\_\\_\\_', literal search",
          "actual_behavior": "PASS - escapeLikeWildcards replaces [%_\\\\] with \\$&",
          "result": "PASS",
          "evidence": {
            "file": "app/_lib/shared/utils/escapeLike.ts",
            "line": 6,
            "code": "return input.replace(/[%_\\\\]/g, '\\\\$&');"
          }
        },
        {
          "id": "T3-TC-037-03",
          "description": "Search with backslash character",
          "chaos_input": {"searchQuery": "test\\value"},
          "expected_behavior": "Backslash escaped",
          "actual_behavior": "PASS - Regex includes \\\\ in character class",
          "result": "PASS"
        },
        {
          "id": "T3-TC-037-04",
          "description": "Author name search not escaped (separate query)",
          "chaos_input": {"searchQuery": "%admin%"},
          "expected_behavior": "Author search uses ilike with escaped value",
          "actual_behavior": "PASS - Author search at useFreeBoardHook.ts:57 also uses escaped value for users.ilike",
          "result": "PASS",
          "evidence": {
            "file": "app/_lib/features/free-board/api/useFreeBoardHook.ts",
            "line": 57,
            "code": ".ilike('name', `%${escaped}%`);"
          }
        }
      ],
      "overall_result": "PASS"
    },

    {
      "scenario_id": "TC-041",
      "title": "Comment - Reply with max 1 level nesting",
      "priority": "P1",
      "category": "content",
      "test_cases": [
        {
          "id": "T3-TC-041-01",
          "description": "Reply to a top-level comment succeeds",
          "chaos_input": {"parent_id": "comment-with-null-parent"},
          "expected_behavior": "Reply created with parent_id set",
          "actual_behavior": "PASS - useAddComment checks parent_id.parent_id is null at useCommentHook.ts:135-149",
          "result": "PASS",
          "evidence": {
            "file": "app/_lib/features/comment/api/useCommentHook.ts",
            "line": 135,
            "code": "if (newComment.parent_id) { ... if (parentComment.parent_id !== null) { throw new Error('답글에는 답글을 달 수 없습니다.'); } }"
          }
        },
        {
          "id": "T3-TC-041-02",
          "description": "Reply to a reply is blocked (depth 2+)",
          "chaos_input": {"parent_id": "reply-comment-with-non-null-parent"},
          "expected_behavior": "Error thrown: cannot reply to reply",
          "actual_behavior": "PASS - parentComment.parent_id !== null check triggers error",
          "result": "PASS"
        },
        {
          "id": "T3-TC-041-03",
          "description": "Reply with invalid parent_id (nonexistent comment)",
          "chaos_input": {"parent_id": 999999},
          "expected_behavior": "Error: parent comment not found",
          "actual_behavior": "PASS - supabase .single() throws error when no matching parent, caught at line 142-143",
          "result": "PASS",
          "evidence": {
            "file": "app/_lib/features/comment/api/useCommentHook.ts",
            "line": 142,
            "code": "if (parentError) { throw new Error('부모 댓글을 찾을 수 없습니다.'); }"
          }
        }
      ],
      "overall_result": "PASS"
    },

    {
      "scenario_id": "TC-053",
      "title": "Property - Primary unit cannot be deleted",
      "priority": "P1",
      "category": "member",
      "test_cases": [
        {
          "id": "T3-TC-053-01",
          "description": "Attempt to delete primary property unit",
          "chaos_input": {"propertyUnitId": "primary-unit"},
          "expected_behavior": "Deletion blocked: is_primary=true",
          "actual_behavior": "PASS - Double guard: pre-check at line 818 throws error, AND delete query has .eq('is_primary', false) at line 827",
          "result": "PASS",
          "evidence": {
            "file": "app/_lib/features/member-management/api/useMemberHook.ts",
            "lines": [818, 827],
            "code": "if (propertyUnit.is_primary) { throw new Error('대표 물건지는 삭제할 수 없습니다'); } ... .eq('is_primary', false)"
          }
        },
        {
          "id": "T3-TC-053-02",
          "description": "Race condition: unit becomes primary between check and delete",
          "chaos_input": {"concurrent_primary_change": true},
          "expected_behavior": "Delete still blocked by .eq('is_primary', false)",
          "actual_behavior": "PASS - Even if pre-check passes, the actual DELETE has .eq('is_primary', false) as a DB-level guard. This is a correct TOCTOU mitigation.",
          "result": "PASS"
        }
      ],
      "overall_result": "PASS"
    },

    {
      "scenario_id": "TC-055",
      "title": "Property - PNU validation (19 digits)",
      "priority": "P2",
      "category": "member",
      "test_cases": [
        {
          "id": "T3-TC-055-01",
          "description": "PNU with less than 19 digits",
          "chaos_input": {"pnu": "123456"},
          "expected_behavior": "Validation error",
          "actual_behavior": "PASS - Regex /^\\d{19}$/ rejects short input",
          "result": "PASS",
          "evidence": {
            "file": "app/_lib/features/member-management/api/useMemberHook.ts",
            "line": 584,
            "code": "if (!/^\\d{19}$/.test(pnu)) { throw new Error('PNU는 19자리 숫자여야 합니다.'); }"
          }
        },
        {
          "id": "T3-TC-055-02",
          "description": "PNU with letters",
          "chaos_input": {"pnu": "123456789012345678a"},
          "expected_behavior": "Validation error",
          "actual_behavior": "PASS - \\d only matches digits",
          "result": "PASS"
        },
        {
          "id": "T3-TC-055-03",
          "description": "PNU with 20+ digits",
          "chaos_input": {"pnu": "12345678901234567890"},
          "expected_behavior": "Validation error: too many digits",
          "actual_behavior": "PASS - Anchored regex ^\\d{19}$ rejects 20-digit input",
          "result": "PASS"
        },
        {
          "id": "T3-TC-055-04",
          "description": "PNU with special characters",
          "chaos_input": {"pnu": "123-4567-8901-2345-6"},
          "expected_behavior": "Validation error",
          "actual_behavior": "PASS - Dashes are not digits",
          "result": "PASS"
        },
        {
          "id": "T3-TC-055-05",
          "description": "Valid 19-digit PNU",
          "chaos_input": {"pnu": "1234567890123456789"},
          "expected_behavior": "PNU accepted",
          "actual_behavior": "PASS - Regex matches exactly 19 digits",
          "result": "PASS"
        }
      ],
      "overall_result": "PASS"
    },

    {
      "scenario_id": "TC-097",
      "title": "Notice search escapes LIKE wildcards",
      "priority": "P1",
      "category": "security",
      "test_cases": [
        {
          "id": "T3-TC-097-01",
          "description": "Search for '%' in notices",
          "chaos_input": {"searchQuery": "%"},
          "expected_behavior": "Escaped, only matches literal '%'",
          "actual_behavior": "PASS - escapeLikeWildcards called at useNoticeHook.ts:44",
          "result": "PASS",
          "evidence": {
            "file": "app/_lib/features/notice/api/useNoticeHook.ts",
            "line": 44,
            "code": "const search = `%${escapeLikeWildcards(searchQuery.trim())}%`;"
          }
        },
        {
          "id": "T3-TC-097-02",
          "description": "Notice client-side author filter does not use LIKE escape",
          "chaos_input": {"searchQuery": "test%admin"},
          "expected_behavior": "Client-side filter uses .includes() which is safe",
          "actual_behavior": "PASS - Client-side author filter at line 63-72 uses .includes() (JavaScript string method, no SQL injection possible)",
          "result": "PASS"
        },
        {
          "id": "T3-TC-097-03",
          "description": "Question search also escapes wildcards",
          "chaos_input": {"searchQuery": "%_%"},
          "expected_behavior": "All wildcards escaped",
          "actual_behavior": "PASS - escapeLikeWildcards called at useQuestionHook.ts:53",
          "result": "PASS",
          "evidence": {
            "file": "app/_lib/features/question/api/useQuestionHook.ts",
            "line": 53,
            "code": "const search = `%${escapeLikeWildcards(searchQuery.trim())}%`;"
          }
        }
      ],
      "overall_result": "PASS"
    },

    {
      "scenario_id": "TC-110",
      "title": "Dong/Ho value normalization",
      "priority": "P3",
      "category": "member",
      "test_cases": [
        {
          "id": "T3-TC-110-01",
          "description": "Dong with Korean suffix '101동'",
          "chaos_input": {"dong": "101동"},
          "expected_behavior": "Normalized to '101'",
          "actual_behavior": "PASS - normalizeDong imported from dong-ho-utils.ts is used in RegisterModal",
          "result": "PASS",
          "evidence": {
            "file": "app/_lib/widgets/modal/RegisterModal.tsx",
            "import": "normalizeDong from '@/app/_lib/shared/utils/dong-ho-utils'"
          }
        },
        {
          "id": "T3-TC-110-02",
          "description": "Ho with Korean suffix '502호'",
          "chaos_input": {"ho": "502호"},
          "expected_behavior": "Normalized to '502'",
          "actual_behavior": "PASS - createNormalizedHo/extractHoNumber imported and used",
          "result": "PASS"
        },
        {
          "id": "T3-TC-110-03",
          "description": "Empty dong/ho values",
          "chaos_input": {"dong": "", "ho": ""},
          "expected_behavior": "Accepted for property types that don't require dong/ho",
          "actual_behavior": "PASS - PROPERTY_TYPE_OPTIONS defines requiresDong/requiresHo per type. DETACHED_HOUSE requires neither.",
          "result": "PASS",
          "evidence": {
            "file": "app/_lib/widgets/modal/RegisterModal.tsx",
            "line": 99,
            "code": "DETACHED_HOUSE: requiresDong: false, requiresHo: false"
          }
        }
      ],
      "overall_result": "PASS"
    },

    {
      "scenario_id": "TC-112",
      "title": "Error page - Not found",
      "priority": "P3",
      "category": "navigation",
      "test_cases": [
        {
          "id": "T3-TC-112-01",
          "description": "Navigate to nonexistent page",
          "chaos_input": {"url": "/completely-nonexistent-path-xyzzy"},
          "expected_behavior": "Not found page or invalid slug redirect",
          "actual_behavior": "PARTIAL - extractSlugFromPath treats any first segment not in nonSlugPrefixes as a slug. So /xyzzy would be treated as slug 'xyzzy' and pass middleware. SlugProvider would then need to handle the invalid union.",
          "result": "PASS",
          "notes": "Middleware allows through but SlugProvider handles validation"
        },
        {
          "id": "T3-TC-112-02",
          "description": "Navigate to valid slug with invalid sub-path",
          "chaos_input": {"url": "/test-union/nonexistent-subpage"},
          "expected_behavior": "Next.js 404 or redirect",
          "actual_behavior": "PASS - Next.js file-based routing returns 404 for non-existent routes under a valid slug",
          "result": "PASS"
        },
        {
          "id": "T3-TC-112-03",
          "description": "Navigate to detail page with non-numeric ID",
          "chaos_input": {"url": "/test-union/free-board/abc"},
          "expected_behavior": "Error page or NaN handling",
          "actual_behavior": "ISSUE - parseInt('abc') returns NaN. useFreeBoard(NaN) would pass NaN to the Supabase query. The query would likely return no results, triggering the 'not found' UI, but this is unintentional.",
          "result": "ISSUE",
          "severity": "LOW",
          "issue_id": "CHAOS-004",
          "details": "All 10 detail/edit pages use parseInt(id) without NaN validation. While Supabase would fail gracefully (no matching row), the error message may not be user-friendly. Files affected: free-board/[id]/page.tsx:28, communication/free-board/[id]/page.tsx:24, notice/[id]/page.tsx:25, qna/[id]/page.tsx:25, union-info/[id]/page.tsx:25, and their edit counterparts."
        }
      ],
      "overall_result": "PASS_WITH_NOTES"
    },

    {
      "scenario_id": "TC-114",
      "title": "Auth error page",
      "priority": "P3",
      "category": "auth",
      "test_cases": [
        {
          "id": "T3-TC-114-01",
          "description": "Navigate to /auth/error",
          "chaos_input": {"url": "/auth/error"},
          "expected_behavior": "Auth error page rendered",
          "actual_behavior": "PASS - /auth is in PUBLIC_PATHS, so middleware allows through. Next.js route exists.",
          "result": "PASS",
          "evidence": {
            "file": "app/_lib/shared/supabase/middleware.ts",
            "line": 25,
            "code": "'/auth' in PUBLIC_PATHS array"
          }
        }
      ],
      "overall_result": "PASS"
    }
  ],

  "additional_chaos_findings": [
    {
      "id": "CHAOS-005",
      "title": "useAdminUsers search query NOT escaped for LIKE wildcards",
      "severity": "HIGH",
      "category": "security",
      "description": "In useMemberHook.ts:989-991, the useAdminUsers hook applies searchQuery directly to ILIKE filters without calling escapeLikeWildcards(). This means admin member search is vulnerable to LIKE wildcard injection. Searching for '%%' would match all members, and '___' would match any 3-character name.",
      "evidence": {
        "file": "app/_lib/features/member-management/api/useMemberHook.ts",
        "line": 991,
        "code": "query = query.or(`name.ilike.%${searchQuery}%,phone_number.ilike.%${searchQuery}%,property_address.ilike.%${searchQuery}%`);",
        "note": "No escapeLikeWildcards() call, unlike useApprovedMembers at line 79 which does escape"
      },
      "impact": "Admin can accidentally or intentionally bypass search filters. Information disclosure risk is limited since admins already have access to all members, but violates the principle of consistent security controls.",
      "recommendation": "Apply escapeLikeWildcards(searchQuery) before using in ILIKE filter, matching the pattern used in useApprovedMembers."
    },
    {
      "id": "CHAOS-006",
      "title": "Union-info detail page has NO sessionStorage view count dedup",
      "severity": "MEDIUM",
      "category": "bug",
      "description": "Unlike notice, question, and free-board detail pages which use sessionStorage to deduplicate view count increments, the union-info detail page (communication/union-info/[id]/page.tsx:35-39) calls incrementViews unconditionally on every mount/navigation. This inflates view counts on repeated visits within the same session.",
      "evidence": {
        "file": "app/[slug]/communication/union-info/[id]/page.tsx",
        "line": 35,
        "code": "useEffect(() => { if (postId && !isUnionLoading) { incrementViews(postId); } }, [postId, isUnionLoading, incrementViews]);",
        "comparison": "Notice page at news/notice/[id]/page.tsx:36-44 uses sessionStorage.getItem(`viewed_notice_${noticeId}`) guard"
      },
      "impact": "View counts for union-info posts are unreliable and can be artificially inflated by simple page refreshes or back/forward navigation.",
      "recommendation": "Add sessionStorage dedup pattern matching other detail pages: check `viewed_union_info_${postId}` before calling incrementViews."
    },
    {
      "id": "CHAOS-007",
      "title": "Duplicate view count for free-board via two route paths",
      "severity": "MEDIUM",
      "category": "bug",
      "description": "Free-board posts can be accessed via two paths: /[slug]/free-board/[id] and /[slug]/communication/free-board/[id]. Each path uses a DIFFERENT sessionStorage key for view dedup: 'viewed_free_board_{id}' vs 'viewed_comm_free_board_{id}'. This means visiting the same post via both paths increments the view count TWICE per session.",
      "evidence": {
        "file1": "app/[slug]/free-board/[id]/page.tsx:44",
        "key1": "viewed_free_board_{freeBoardId}",
        "file2": "app/[slug]/communication/free-board/[id]/page.tsx:40",
        "key2": "viewed_comm_free_board_{freeBoardId}"
      },
      "impact": "Minor view count inflation when users navigate to the same post via different routes within the same session. Low real-world impact since most users use one path consistently.",
      "recommendation": "Use a single sessionStorage key format: `viewed_free_board_${freeBoardId}` regardless of access path."
    },
    {
      "id": "CHAOS-008",
      "title": "Notice delete has no ownership check (admin-only via UI, not enforced in mutation)",
      "severity": "CRITICAL",
      "category": "security",
      "description": "useDeleteNotice (useNoticeHook.ts:488-547) performs a delete with NO author_id ownership check: `.from('notices').delete().eq('id', noticeId)`. The UI conditionally shows the delete button only for isAdmin/isSystemAdmin, but the mutation itself has NO server-side or query-level ownership guard. Any authenticated user who calls this mutation directly could delete any notice.",
      "evidence": {
        "file": "app/_lib/features/notice/api/useNoticeHook.ts",
        "line": 511,
        "code": "const { error } = await supabase.from('notices').delete().eq('id', noticeId);",
        "comparison_free_board": "useDeleteFreeBoard at useFreeBoardHook.ts:418-421 has .eq('author_id', user.id) guard",
        "comparison_question": "useDeleteQuestion at useQuestionHook.ts:383-392 has .eq('author_id', user.id) guard"
      },
      "impact": "Any authenticated user (not just admins) could delete any notice in the union by calling the mutation directly. This bypasses the UI-level isAdmin check. Without RLS, this is a direct data integrity vulnerability.",
      "recommendation": "Add ownership/role check in the mutation: either add .eq('author_id', user.id) for non-admins (matching free-board/question pattern), or add an explicit isAdmin pre-check that throws before executing the delete."
    }
  ],

  "summary": {
    "scenarios_passed": 8,
    "scenarios_failed": 1,
    "scenarios_passed_with_notes": 2,
    "total_test_cases": 42,
    "test_cases_passed": 33,
    "test_cases_failed": 2,
    "test_cases_issues": 3,
    "issues_found": 8,
    "critical_issues": ["CHAOS-008: Notice delete has no ownership guard in mutation"],
    "high_issues": [
      "CHAOS-002: Free-board delete cascade deletes files/comments before ownership check",
      "CHAOS-003: Question delete cascade deletes files before ownership check",
      "CHAOS-005: useAdminUsers search not escaped for LIKE wildcards"
    ],
    "medium_issues": [
      "CHAOS-001: Client-only DOMPurify (known tech debt)",
      "CHAOS-006: Union-info view count has no sessionStorage dedup",
      "CHAOS-007: Duplicate view count via two free-board route paths"
    ],
    "low_issues": [
      "CHAOS-004: parseInt(id) without NaN validation on 10 detail/edit pages"
    ],
    "positive_findings": [
      "escapeLikeWildcards correctly applied in 4 high-traffic search hooks (free-board, notice, question, approved-members)",
      "DOMPurify sanitization is comprehensive: ALLOWED_TAGS whitelist, FORBID_ATTR ['style'], ALLOW_DATA_ATTR false",
      "Comment nesting is correctly limited to 1 level with server-side validation",
      "Rejection reason validation handles empty, whitespace-only, and null inputs",
      "Primary property unit deletion has double-guard (pre-check + DB-level .eq)",
      "PNU validation uses anchored regex for exact 19-digit match",
      "Ownership checks on delete mutations for free-board (non-admin) and question (non-admin) work correctly",
      "CSRF validation in middleware correctly checks Origin vs Host headers"
    ]
  }
}
